<!DOCTYPE html>
<html>
  <head>
    <title>Test page</title>
    <base target="_top">
    <meta http-equiv="Content-Type" content="text/html;charset=UTF-8"> 
	  <script type="text/javascript" src="./js/jquery-1.9.1.js"></script>
    <link rel="stylesheet" href="./css/add-ons.css" >
    <style>
      .result-display {
        margin-left: 15px;
        font-size: 125%;
      }    
      .error {
        color: #FF0000;
      }    
      .hidden {
        display: none;
      }
      table tr{
        width:100%;
      }
      td{
        height:25px;  
      }
      #btnVerify{
        height: 40px;
      }
      .numtext ,.inputPriority{
        width:40px;
        height: 40px !important;
        font-size: 30px !important;
        text-align: center;
      }
      .divcontent{
        position: absolute;
        left: 50%;
        margin: 0 0 0 -105px;
      }
      </style>
    
  </head>

  <body>  
    <div class="divcontent" >
      <div class="block result-display">
        <table>
          <tr>
            <td><button id="btnViewAns" disabled>看答案</button></td>
            <td><button id="btnStart">重新遊戲</button></td>          
          </tr>             
        </table>  
      </div>
      <div class="block result-display" id="results">
        <table id="tab_ques">
          <tr>
            <th colspan="4">答案</th>
          </tr>
          <tr id="ans">
            <td><input type="text" class="numtext" id="num_1" readonly></input></td>
            <td><input type="text" class="numtext" id="num_2" readonly></input></td>
            <td><input type="text" class="numtext" id="num_3" readonly></input></td>
            <td><input type="text" class="numtext" id="num_4" readonly></input></td>          
          </tr>        
        </table>  
      </div>
      <div  class="block result-display">
        <table id="tab_ans">    
          <tr>
            <th colspan="5">作答</th>
          </tr>   
          <tr>
            <td><input type="text" class="inputPriority" maxlength="1" id="uAns1"></input></td>
            <td><input type="text" class="inputPriority" maxlength="1" id="uAns2"></input></td>
            <td><input type="text" class="inputPriority" maxlength="1" id="uAns3"></input></td>
            <td><input type="text" class="inputPriority" maxlength="1" id="uAns4"></input></td>
            <td><button id="btnVerify" disabled>驗證</button></td>
          </tr>        
        </table>  
      </div>
      <div class="block result-display">
        <textarea id="strVerify" style="width:230px;height:290px;font-size: 28px;text-align: center;resize: none;"></textarea>  
      </div>
    </div>  
    <script>      
      var ans = {};
      var verifynum = 0;
      $(".inputPriority").prop('disabled', true);

      $("#btnViewAns").click(function(){    
        $("#ans").find("td>input").show();
        $("#btnVerify").prop('disabled', true);    
      });
      $("#btnStart").click(function(){        
        $("#ans").find("td>input").hide();
        $("#btnVerify").prop('disabled', false);
        $("#btnViewAns").prop('disabled', false);
        $(".inputPriority").prop('disabled', false);
        getNum();
      });
      $("#btnVerify").click(function(){    
        var re_A=0; 
        var re_B=0;
        var anstotal = "";    
        var v = {};
        var err = ""; 
        for(var i = 1; i<=4; i++){
          var tmpAns = $("#uAns"+i).val();
          if(v.hasOwnProperty(tmpAns)){
            err = "輸入數值重複";
            break;
          }else{
            v[tmpAns] = i;
          }
          anstotal += tmpAns;
          if(ans.hasOwnProperty(tmpAns)){
            if(ans[tmpAns] == i){
              re_A += 1;
            }else{
              re_B += 1;
            }
          }
        }    
        if(err == ""){
          verifynum+=1;  
          
          var re_string = anstotal + "=>"+ re_A+"A"+re_B+"B";      
          var tmpVerify = $("#strVerify").val();
          tmpVerify = verifynum + "." + re_string + "\n" + tmpVerify;    

          if(re_A == 4){
            $("#strVerify").val(tmpVerify);
            $("#btnViewAns").prop('disabled', true);
            alert("成功!");
          } else if(verifynum == 10){
            $("#strVerify").val(tmpVerify);
            $("#btnVerify").prop('disabled', true);  
            $("#btnViewAns ").prop('disabled', true); 
            $("#btnViewAns").click();
            alert("遊戲結束");
          }else{
            $("#strVerify").val(tmpVerify);
          }
        }else{
          alert(err);
        }   
      });  
      function getRandom(x){
        return Math.floor(Math.random()*x)+1;
      };
      function getNum(){  
        $("#strVerify").val("");
        verifynum=0;  
        ans = {};
        var n = 0;
        //4個數字
        for(i=1; i <= 4; i++){
          n = getRandom(9);
          if(ans.hasOwnProperty(n)){
            i-=1;
            continue;
          }
          else{
            $("#num_"+i).val(n);
            ans[n]=i;
            if(!ans.hasOwnProperty("ans")){
              ans["ans"] = n;
            }else{
              ans["ans"] = ans["ans"] +" " +n;
            }
            
          };
        };
        //return ans;
      };
      $(".inputPriority").keydown(function(e){
            if(e.keyCode == 229)
              return false;
              
        }).bind("input",function(){          
          var start = this.selectionStart;
          var arrChar = this.value.split("");
          var str = arrChar[start-1];
          var keyCode = str.charCodeAt(0);
          
          if ( !(keyCode >= 48 && keyCode <= 57))
          {
            if(arrChar.length == start)
            {
              arrChar.pop();
            }
            else
            {
              arrChar.splice(start-1,1);
            }
            this.value = arrChar.join("");
            this.setSelectionRange(start-1,start-1);
          }
        });

        $("#btnStart").click();
    </script>
  </body>
</html>
